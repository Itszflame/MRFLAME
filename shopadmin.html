<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MR. FLAME — Shop</title>
  <link rel="stylesheet" href="style.css">
</head>
<body data-page="user">
  <video id="bgVideo" class="bg-video" autoplay muted loop playsinline poster="Logo.jpeg">
    <source src="bg.mp4" type="video/mp4">
  </video>

  <header class="topbar">
    <div class="brand">MR. FLAME — Shop</div>
    <div id="userBadge" class="user-badge">Guest</div>
  </header>

  <main class="container">
    <div class="glass-card container-card">
      <h3>Welcome — <span id="displayUser">User</span></h3>
      <p class="muted">You can view product details below. Use DM to contact the admin.</p>

      <div id="productGrid" class="grid"></div>

      <div style="margin-top:14px;display:flex;gap:10px;justify-content:center">
        <button id="backToEntry" class="btn btn-outline">Back</button>
      </div>
    </div>
  </main>

  <div id="navOverlay" class="overlay hidden" aria-hidden="true">
    <div class="overlay-glow"></div>
    <div class="overlay-content" role="status" aria-live="polite">
      <div class="spinner-orb"><div class="orb-inner"></div></div>
      <div id="overlayText" class="overlay-text">Loading...</div>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    (function(){
      // require session
      const cur = JSON.parse(localStorage.getItem('mrflame_current') || 'null');
      if(!cur){ window.location.href = 'shop.html'; return; }

      document.getElementById('displayUser').textContent = cur.username || 'User';
      document.getElementById('userBadge').textContent = cur.username || 'Guest';

      function loadProducts(){
        const p = JSON.parse(localStorage.getItem('mrflame_products') || 'null');
        if(!p) {
          return [
            { id:'p1', title:'GameSetupFile', price:'₹999', image:'bgmi.jpg', desc:'Complete game setup package' },
            { id:'p2', title:'My PC', price:'₹59,999', image:'palworld.jpg', desc:'Custom gaming rig' },
            { id:'p3', title:'Mouse Pad', price:'₹299', image:'Gta.jpg', desc:'Large cloth mouse pad' },
            { id:'p4', title:'Flame Hoodie', price:'₹1599', image:'Logo.jpeg', desc:'Comfortable branded hoodie' },
            { id:'p5', title:'Gaming Keyboard Combo', price:'₹3499', image:'palworld.jpg', desc:'Keyboard + wrist rest combo' }
          ];
        }
        return p;
      }

      function render(){
        const grid = document.getElementById('productGrid');
        const products = loadProducts();
        grid.innerHTML = '';
        products.forEach(p=>{
          const el = document.createElement('div');
          el.className = 'card-prod';
          el.innerHTML = `
            <img src="${p.image}" alt="${p.title}">
            <div class="prod-title">${p.title}</div>
            <div class="prod-price">${p.price}</div>
            <div class="muted" style="font-size:13px">${p.desc || ''}</div>
            <div class="prod-actions">
              <div>
                <button class="small-btn dm-btn" data-id="${p.id}">DM Admin</button>
              </div>
              <div>
                <button class="small-btn view-btn" data-id="${p.id}">View</button>
              </div>
            </div>
          `;
          grid.appendChild(el);
        });

        // attach handlers
        grid.querySelectorAll('.dm-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            window.MRFLAME_overlay.show('Opening DM...');
            setTimeout(()=> {
              window.MRFLAME_overlay.hide();
              window.open('https://instagram.com/itszflame?igshid=OGQ5ZDc2ODk2ZA%3D%3D', '_blank', 'noopener');
            }, 1000);
          });
        });
        grid.querySelectorAll('.view-btn').forEach(btn => {
          btn.addEventListener('click', (ev) => {
            const pid = ev.currentTarget.dataset.id;
            const products = loadProducts();
            const p = products.find(x=>x.id===pid);
            alert(`${p.title}\n\n${p.desc}\n\nPrice: ${p.price}`);
          });
        });
      }

      document.getElementById('backToEntry').addEventListener('click', () => {
        localStorage.removeItem('mrflame_current');
        window.location.href = 'shop.html';
      });

      render();
    })();
  </script>
</body>
</html>
